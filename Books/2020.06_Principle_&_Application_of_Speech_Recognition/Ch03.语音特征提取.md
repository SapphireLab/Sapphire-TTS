
# 03.语音特征提取

## 1. 预处理
首先对原始语音时域信号进行预处理, 包括预加重, 分帧, 加窗
### 预加重 Pre-emphasis

语音经发生者的口唇辐射发出, 受到唇端辐射抑制, 高频能量明显降低.
一般而言, 当语音信号的频率提高两倍时, 其功率谱的幅度下降约 6 dB, 即语音信号的高频部分受到的抑制影响较大.
在进行语音信号的分析和处理时, 可采用**预加重 Pre-emphasis** 方法补偿语音信号高频部分的振幅.

假设输入信号第 $n$ 个采样点为 $x[n]$, 则预加重公式如下:
$$
	x'[n] = x[n] - a\times x[n-1]
$$
- $a$ 是预加重系数, 可取 1 或略小于 1 的数值, 一般取 0.97.

### 分帧

从整体上看语音信号是一个非平稳信号, 但考虑到发浊音时声带有规律地振动, 即基音频率在短时范围内是相对固定的, 因此可以认为语音具有**短时平稳特性**, 一般认为 10ms~30ms 的语音信号片段是一个准稳态过程.

短时分析主要采用分帧方式, 一般每帧帧长 20ms 或 25ms.

假设采样率为 16kHz, 帧长为 25ms, 则一帧有 16000 * 0.025=400 个采样点.

相邻两帧之间的基因可能发生变化, 如正好在两个音节之间或声母向韵母过渡等.
为了确保声学特征参数的平滑性, 一般采用重叠取帧的方式, 即相邻帧之间存在重叠部分, 帧移一般为 10ms, 重叠 50%~60%.

### 加窗

分帧方式相当于对语音信号进行了加矩形窗的处理, 矩形窗在时域上对信号进行有限截断, 对应频域的通道较窄, 边界处存在多个旁瓣, 发生严重的频谱泄露.

矩形窗的窗函数:
$$
w_{reg}[n]=
\begin{cases}
1, &0\leq n\leq N-1\\
0, &n\leq 0 \text{ or } n\geq N-1 
\end{cases}
$$

为了减少频谱泄露, 通常对每帧的信号进行其他形式的加窗处理.
常用的窗函数有:

- 汉明窗 Hamming
$$
w_{ham}[n]=0.54 - 0.46\cos(\dfrac{2\pi n}{N}-1)
$$
- 汉宁窗 Hanning
$$
w_{han}[n]=0.5[1 - \cos(\dfrac{2\pi n}{N}-1)]
$$
- 布莱克曼窗 Blackman
$$
w_{bm}[n]=0.42 - 0.5\cos(\dfrac{2\pi n}{N})0.08 \cos(\dfrac{4\pi n}{N})
$$

考虑语音信号的短时平稳性, 对每帧语音信号进行加窗处理, 得到短时加窗的语音信号 $x_l[n]$, 即
$$
	x_l[n] = w[n]x[n+lL]
$$
- $w[n]$ 是窗函数;
- $l$ 是帧索引;
- $L$ 是帧移.



## 2. 短时傅立叶变换 STFT
人类语音的感知过程与听觉系统具有频谱分析功能紧密相关.
因此对于语音信号进行频谱分析, 是认识和处理语音信号的重要方法.
声音从频率上可以分为纯音和复合音.
纯音只含有一种频率的声音 (基音) 而没有倍音.
复合音是除了基音外, 还包含多种倍音的声音.
大部分声音都是复合音, 涉及多个频率段.

每个频率的信号可以用正弦波表示, 采用正弦函数建模.
基于欧拉公式, 可将正弦函数对应到统一的指数形式
$$
	e^{j\omega n} = \cos(\omega n) + j\sin(\omega n)
$$

正弦函数具有正交性, 即任意两个不同频率的正弦波的乘积, 在两者公共周期内的积分等于零, 即
$$
\int_{-\infty}^{+\infty} e^{j\alpha t}e^{j\beta t}\text{d}t=0, \quad\alpha\neq \beta.
$$

基于正交性, 通过相关处理可从语音信号分离出对应不同频率的正弦信号.

对于离散采样的语音信号, 可采用[[离散傅立叶变换 DFT]].
DFT 的第 $k$ 个点计算如下:
$$
	X[k] = \sum_{n=0}^{N-1} x[n] e^{-\dfrac{j2\pi k n}{K}}, \quad k=0,\cdots,K-1.
$$
- $x[n]$ 是时域波形第 $n$ 个采样点值;
- $X[k]$ 是第 $k$ 个点的傅立叶频谱值;
- $N$ 是采样点序列的点数;
- $K$ 是频谱系数的点数, 且 $K\geq N$$

DFT 系数通常是复数形式, 将欧拉公式展开得到:
$$
	X[k] = X_{real}[k] - j X_{imag}[k]
$$
$$
	X_{real}[k] = \sum_{n=0}^{N-1} x[n]\cos(\dfrac{2\pi k n}{K}),
$$
$$
	X_{imag}[k] = \sum_{n=0}^{N-1} x[n]\sin(\dfrac{2\pi k n}{K})
$$
假设 $N$ 个采样点的时域信号经过 DFT 后, 对应 $K$ 个频率点.
序号 0 的点对应 0 Hz 的频率点;
序号 $K-1$ 的点对应 $\dfrac{K-1}{K}\times \dfrac{F_s}{2}$ Hz 的频率点, $F_s$ 是采样率.

经过 DFT 得到信号的频谱表示, 其频谱幅值和相位随着频率变化而变化.

在语音信号处理中主要关注信号的频谱赋值, 又称为振幅频谱, 表示如下:
$$
	X_{magnitude}[k] = \sqrt{X_{real}[k]^2+X_{imag}[k]^2}
$$

能量频谱用振幅频谱的平方表示:
$$
	X_{power}[k] = X_{real}[k]^2 + X_{imag}[k]^2
$$

各种声源发出的声音大多是由许多不同强度, 不同频率的声音组成的复合音.
在复合音中, 不同频率成分的声波具有不同的能量, 这种频率成分与能量分布的关系称为声音的频谱 Frequency Spectrum.

通过对频域信号进行逆离散傅立叶变换 IDFT, 可恢复时域信号:
$$
	x[n] = \dfrac{1}{K}\sum_{k=0}^{K-1} X[k]e^{-\dfrac{j2\pi kn}{N}}, \quad n =0,\cdots, N-1
$$

DFT 的计算复杂度为 $O(N^2)$. 根据复数的奇偶虚实关系, 采用快速傅立叶变换 FFT, 可简化计算复杂度, 在 $O(N\log_2 N)$ 的时间内计算出 DFT.

在实际应用中, 对语音信号进行分帧加窗处理, 将其分割成一帧帧的离散序列, 可视此为短时傅立叶变换 STFT:
$$
	X[k,l] = \sum_{n=0}^{N-1} x_l[n]e^{-\dfrac{j2\pi n k}{K}}=\sum_{n=0}^{N-1} w[n]x[n+lL]e^{-\dfrac{j2\pi n k}{K}}
$$

## 3. 听觉特性

人类感知声音受频率和声强的影响. 

客观上, 用频率表示声音的音高, 频率低的声音听起来感觉音调低, 但是音调和频率不成正比关系.
音调的单位是 mel 频率, 用来模拟人耳对不同频率语音的感知.
1 mel 相当于 1 kHz 音调感知程度的 1/1000.

$$
	mel(f) = 2595\lg(1+f/700)
$$
人耳对低频信号对比高频信号更敏感.

研究者提出类似于耳蜗作用的一个滤波器组, 用于模拟人耳对不同频段声音的感知能力, 由多个三角滤波器组成的 mel 频率滤波器组. 每个滤波器的带宽不等, 线性频率小于 1000 Hz 的部分作为线性间隔, 而线性频率大于 1 kHz 的部分为对数间隔.

Mel 滤波器组的第 $m$ 个滤波函数 $H_m(k)$ 定义如下:
$$
H_m(k)=
\begin{cases}
0, &k<k_{b_{m-1}},\\
\dfrac{k-k_{b_{m-1}}}{k_{b_{m}}-k_{b_{m-1}}}, & k_{b_{m-1}}\leq k\leq k_{b_m},\\
1, & k=k_{b_m},\\
\dfrac{k_{b_{m-1}}-k}{k_{b_{m+1}}-k_{b_{m}}}, & k_{b_{m-1}}\leq k\leq k_{b_m},\\
0,&k>k_{b_{m+1}}
\end{cases}
$$
- $M$ 是滤波器的个数;
- $k_{b_m}$ 是滤波器的临界频率;
- $k$ 表示 $K$ 点 DFT 变换的频谱系数序号;

$$
k_{b_m} = (\dfrac{K}{F_s}) f^{-1}_{mel} [f_{mel}(f_{low})) + \frac{m(f_{mel}(f_{high})-f_{mel}(f_{low}))}{M+1}]
$$
- $f_{mel}$ 表示频率到 mel 频率的转换;
- $f_{low}$ 是滤波器的下截止频率;
- $f_{high}$ 是滤波器的上截止频率;

$$
	f_{mel}^{-1}(f_{mel}) = 700(10^{\dfrac{f_{mel}}{2595}}-1)
$$

声音的响度是反映人主观上感觉的不同频率成分的声音强弱 (声强) 的物理量, 单位为方 (phone), 可以由时变的压力 (声压) P 来表示, 单位为帕斯卡 (Pa).

对于空气中传播的声音, 通常取其与对应参考声压 20 微帕的比值的对数来衡量其压力大小, 这个对数比值称为声压级 (SPL).

响度与声强, 频率的关系可以用等响度轮廓曲线表示.

人耳对响度的感知有一个范围, 低于某个响度时人耳是无法感知它的, 这个响度值称为听觉阈值, 听阈. 当声音响度强到人耳感到疼痛时的值称为痛阈.

邻近频率的两个声音信号, 弱响度的声音信号会被强响度的声音信号所掩蔽, 即频域掩蔽.

根据听觉频域分辨力和频域掩蔽的特点, Harvey Fletcher 提出临界频带的概念, 即在某一段频率范围内若干纯音和噪音功率相等, 则该纯音处于刚好能被听到的临界状态, 是引起听觉主管变化的频率带宽. 我们定义这样一个频率范围为一个临界频带.

一个临界频带的宽带被称为一个 Bark, Bark 频率 $Z(f)$ 和线性频率 $f$ 的对应关系定义如下:
$$
	Z(f) = 6\ln\left\{ \frac{f}{600}+[(\dfrac{f}{600})^2+1]^{\dfrac{1}{2}} \right\}  
$$
临界频带 $Z(f)$ 的单位为 Bark, 线性频率 $f$ 的单位为 Hz.

## 4. 线性预测

语音信号的产生模型主要包括发生源 Source 和滤波器 Filter.
人在发声时, 肺部空气受到挤压形成气流, 气流通过声门 (声带) 振动产生声门源激励 $e[n]$.
对于浊音, 激励是以基因周期重复的单位冲激;
对于清音, 激励是平稳白噪声.
激励信号经过声道的共振与调制, 特别是舌头可以灵活改变声道的容积从而改变发音, 形成不同频率的声音.
气流和声门可以等效为一个激励源, 声道等效为一个时变滤波器, 那么语音信号 $x[n]$ 可以看成激励信号 $e[n]$ 与时变滤波器的单位取样相应 $v[n]$ 的卷积:
$$
	x[n] = e[n] * v[n].
$$
根据语音信号的产生模型, 语音信号可以等价以 $e[n]$ 为激励的一个全极点 (AR 模型) 或一个零极点 (ARMA 模型) 滤波器的响应.
如果用一个 $p$ 阶全极点系统模拟激励产生语音的过程, 设这个 AR 模型的传递函数为
$$
	V(z)=\dfrac{X(z)}{E(z)} = \dfrac{G}{A(z)} = \dfrac{G}{1-\sum_{i=1}^p a_i z^{-i}},
$$
- $G$ 是增益.

语音信号与激励信号之间的关系为
$$
	x[n]= G\cdot e[n] +\sum_{i=1}^p a_i x[n-i]
$$

可见语音信号的采样点之间有相关性, 可以用过去若干个采样点值的线性组合来预测未来的采样点值. 通过使线性预测的采样点值在最小均方误差约束下逼近实际语音采样点值, 可以求取一组唯一的预测系数, 简称为线性预测编码 (Linear Prediction Coding, LPC) 系数.

在 AR 模型参数估计过程中, 定义线性预测器为
$$
	\hat{x}[n]=\sum_{i=1}^p a_i x[n-i]
$$
预测误差为 $\varepsilon[n]$:
$$
	\varepsilon [n] = x[n] - \hat{x}[n] = G\cdot e[n]
$$

定义某一帧内短时平均预测误差为 $\mathbb{E}[\varepsilon^2[n]]$, 使其最小化, 对 $a_j$ 求偏导, 令其为零, 计算出预测系数.

## 5. 倒谱分析/同态滤波

已知语音信号 $x[n]$, 要求出 $x[n]=e[n]*v[n]$ 中参与卷积的各个信号分量, 即解卷积操作.
除了[[03 语音特征提取#4. 线性预测 | 线性预测技术]]外, 还可以使用倒谱分析实现.

倒谱分析主要采用时域变换, 得到对数功率谱再进行逆变换, 分析出倒谱域的倒谱系数.
1. 傅立叶变换: 将时域的卷积信号转换为频域的乘积信号
	$$
	DFT(x[n]) = X[z]=E[z]V[z]
  $$
2. 对数运算: 将乘积信号转换为加性信号
	$$
	\log X[z] = \log E[z] + \log V[z] = \hat{E}[z]+\hat{V}[z]=\hat{X}[z]
  $$

3. 傅立叶反变换: 得到时域的语音信号倒谱
	$$
	Z^{-1}(\hat{X}[z]) = \hat{e}[n]+\hat{v}[n]\approx \hat{x}[n]
  $$

实际应用中, 离散余弦变换 DCT 具有最优的去相关性能, 能够将信号能量集中到极少数的变换系数上, 特别是能将大多数的自然信号的能量都集中在离散余弦变换后的低频部分.

语音信号的频谱可以被看成低频的包络和高频的细节调制形成,
因此一般采用 DCT 反变换代替傅立叶反变换, 直接获取低频倒谱系数.
对应于包络信息, 也就是声道特征, 反变换公式可写为

$$
	\hat{c}[m] = \sum_{k=1}^N \log X[k]\cos(\dfrac{\pi(k-0.5)m}{N}),\quad m=1,\cdots,M.
$$
- $X[k]$ 是 DFT 变换系数;
- $N$ 是 DFT 系数个数;
- $M$ 是 DCT 变换的个数.

由于 DCT 变换的不可逆性, 从倒谱信号无法还原出语音.

## 6. 常用的声学特征

一般基于发声机制或人耳感知机制提取得到频谱空间的向量表示, 即声学特征.
常用的声学特征有:
- Mel 频率倒谱系数 Mel-Frequency Cepstral Coefficient, MFCC
- 感知线性预测系数 Perceptual Linear Predictive, PLP
- 滤波器组 Filter-bank, Fbank
- 语谱图 Spectrogram
- 常数 Q 倒谱系数 Constant-Q Cepstral Coefficient, CQCC

![[声学特征提取流程.canvas]]

语音信号经过短时傅立叶变换 STFT 后得到的频谱为对称谱.
取正频率轴的频谱曲线将每一帧的频谱值按时间顺序拼接.

语谱图横坐标为时间, 纵坐标为频率, 用颜色深浅表示频谱值的大小.

Fbank 特征本质上是对数功率谱, 包括低频和高频信息, 相比语谱图, FBank 经过了 Mel 滤波器组的处理, 抑制了一部分听觉无法感知的冗余信息.

MFCC 作为静态特征, 其一阶和二阶差分称为动态特征.

逆 Mel 频率倒谱系数特征 (Inverted Mel Frequency Cepstral Coefficients, IMFCC) 的提取过程是在 MFCC 的基础上, 把梅尔滤波器组的排列方式进行改造, 使得低频部分较松散, 高频部分较密集.

PLP 是基于 Bark 听觉模型的特征参数, 其采用 LPC 实现语音信号的解卷处理, 得到相应的声学特征参数.

CQCC 常数 Q 变换